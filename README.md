# Шарнин Никита Сергеевич, задача №2

## 1. Постановка задачи

1. Разработать сервис стриминга с computer vision object detection, используя модель YOLOv7
2. Реализовать распределенный формат вычислений для сервиса, с использованием фреймворка Spark (sparkStreaming)
3. В качестве брокеров сообщений допустимо использовать Apache Kafka и Redis
4. Добиться производительности не менее 30 fps на доступных ресурсах, с разрешением 1280х720


## 2. Описание проекта

Проект представляет собой многоконтейнерный сервис, в котором kafka-producer в реальном времени извлекает кадры из видеопотока и отправляет их в Kafka. Затем с помощью kafka-producer кадры извлекаются из топика и обрабатываются детектором YOLOv7-tiny. Tiny версия была выбрана для того, чтобы обеспечить быстроту детекции. К сожалению, я ещё только изучаю работу со Spark, поэтому мне пока не удалось обеспечить потоковое взаимодействие Spark и модели YOLO. Ещё одним способом повысить скорость работы модели является ONNX. Данная технология позволит оптимизировать обученную модель. Предоставленный в рамках хакатона видеопоток представляет из себя запись с камеры наблюдения, которая демонстрирует дорожный трафик, поэтому для обучения модели был выбран датасет BDD10K. Применение всех перечисленных методов должно позволить приблизиться к требуемым показателям FPS при заданном разрешении. Но для тестирования необходимо завершить работу над кодом проекта.

## 3. Сборка проекта

### Для того, чтобы собрать и запустить данный проект необходимо выполнить следующие команды:

1. docker-compose up -d
2. docker-compose exec spark bash
3. cd /app
4. mkdir myenv
5. cd myenv
6. virtualenv venv
7. source venv/bin/activate
8. cd ..
9. pip install -r requirements.txt
10. apt-get update && apt-get install libgl1
11. apt-get install libglib2.0-0
12. python producer/producer.py & spark-submit --packages org.apache.spark:spark-sql-kafka-0-10_2.12:3.4.0 consumer/consumer.py




